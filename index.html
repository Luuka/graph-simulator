<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="Graph.js" charset="utf-8"></script>
    <script src="./vis.min.js" charset="utf-8"></script>
    <title>Graphe</title>
    <style>

    * {
        font-family: sans-serif;
    }

    h2 {
        text-align: center;
    }

    .graph {
        width: 500px;
        height: 500px;
        border: 1px solid #f1f1f1;
    }

    .part {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
    }

    .status {
        margin: 15px;
    }

    #originalGraph, #warshallGraph{
        justify-content: space-around;
    }

    table, tr, td, th {
        border-collapse: collapse;
    }

    td, th{
        width: 25px;
        height: 25px;
        text-align: center;

    }

    tbody th {
        border-right: 1px solid black;
    }

    thead th {
        border-bottom: 1px solid black;
    }

    thead th:nth-child(1){
        background: black;
    }

    input {
        margin: 0 5px;
    }
    </style>
</head>
<body>
    <div class="part">
        Initialiser le graphe :
        <input type="number">
        <input type="button" placeholder="Nombre de noeuds" value="Créer" id="createGraph">

        <button id="playTest">Lancer le scénario de test</button>
    </div>
    <hr>
    <div class="part">
        De
        <input type="number" id="from">
        vers
        <input type="number" id="to">
        <input type="button" name="" value="Ajouter" id="addEgde">
    </div>
    <hr>
    <h2>Graphe original</h2>
    <hr>
    <section class="part">
        <div class="status">
            <span id="graphStatus"></span>
        </div>

        <div id="verticeInfo" class="status">

        </div>
    </section>
    <hr>
    <section id="originalGraph" class="part">
        <div id="graph" class="graph"></div>
        <div id="matrix"></div>
    </section>
    <hr>
    <h2>Fermeture transitive et CFC</h2>
    <hr>
    <section class="part">
        <div class="status">
            <span id="warshallGraphStatus"></span>
        </div>

        <div id="warshallVerticeInfo" class="status">

        </div>
    </section>
    <hr>
    <section id="warshallGraph" class="part">
        <div id="graphWarshall" class="graph"></div>
        <div id="warshall"></div>
        <div id="CFC"></div>
    </section>

    <script type="text/javascript">

    document.addEventListener('DOMContentLoaded', function() {

        var g;

        document.getElementById('createGraph').addEventListener('click', function(){
            var size = parseInt(this.previousElementSibling.value);
            createGraph(size);
        });

        document.getElementById('playTest').addEventListener("click", function(){
            createGraph(12);

            var edges = [
                {from:'1', to:[12]},
                {from:'2', to:[1,3]},
                {from:'3', to:[10]},
                {from:'4', to:[5,6]},
                {from:'5', to:[4,6]},
                {from:'6', to:[3,9]},
                {from:'7', to:[8,9]},
                {from:'8', to:[7]},
                {from:'9', to:[10]},
                {from:'10', to:[9]},
                {from:'11', to:[10]},
                {from:'12', to:[2,3]}
            ];

            for(var edge of edges){
                for(var to of edge.to){
                    addEgde(edge.from, to);
                }
            }

        });

        function createGraph(size){
            g = new Graph(size);
            console.log(g);
            displayGraph(g, "graph", "verticeInfo");
            displayMatrix(g, "matrix");

            var gplus = g.transitiveClosing();

            displayGraph(gplus, "graphWarshall", "warshallVerticeInfo");
            displayMatrix(gplus, "warshall");
            displayGraphInfo(g, 'graphStatus');
        }


        document.getElementById('addEgde').addEventListener('click', function(){
            var from = parseInt(document.getElementById('from').value);
            var to = parseInt(document.getElementById('to').value);

            addEgde(from, to);
        });

        function addEgde(from, to){
            g.addEgde(from, to);
            displayGraph(g, "graph", "verticeInfo");
            displayMatrix(g, "matrix");
            displayGraphInfo(g, "graphStatus");

            var gplus = g.transitiveClosing();

            displayGraph(gplus, "graphWarshall", "warshallVerticeInfo");
            displayMatrix(gplus, "warshall")
            displayCFCS(g, "CFC");
            displayGraphInfo(gplus, "warshallGraphStatus");

            document.getElementById('from').value = "";
            document.getElementById('to').value = "";
        }
    });


    function displayGraph(g, selector, verticeInfoSelector){
        var nodesDataset = new vis.DataSet(g.prepareNodesDataSet());
        var edgesDataset = new vis.DataSet(g.prepareEdgesDataSet());

        // create a network
        var container = document.getElementById(selector);
        var data = {
            nodes: nodesDataset,
            edges: edgesDataset
        };
        var options = {};
        var network = new vis.Network(container, data, options);

        network.on( 'click', function(properties) {
            displayVerticeInfo(g,properties.nodes[0], verticeInfoSelector);
        });
    }

    function displayGraphInfo(g, selector) {
        var graphStatus = "";
        if(g.isEmpty()){
            graphStatus = "Le graphe est vide et contient "+g.size()+" sommets.";
        }else{
            graphStatus = "Le graphe contient "+g.size()+" sommets et "+g.edgeCount()+" arcs.";
        }
        document.getElementById(selector).innerHTML = graphStatus;
    }

    function displayVerticeInfo(g,v, verticeInfoSelector){

        var html = "";

        html += "<strong>Successeurs de "+v+"</strong> : " + g.getSuccessors(v)+"<br />";
        html += "<strong>Prédécesseurs de "+v+"</strong> : " + g.getPredecessors(v)+"<br />";
        html += "<strong>Degré sortant de "+v+"</strong> : " + g.getOutgoingDegree(v)+"<br />";
        html += "<strong>Degré entrant de "+v+"</strong> : " + g.getIncomingDegree(v)+"<br />";


        document.getElementById(verticeInfoSelector).innerHTML = html;
    }

    function displayMatrix(g, selector){
        document.getElementById(selector).innerHTML = g.asHTMLTable();
    }

    function displayCFCS(g, selector){
        var cfcs = g.searchCFC();

        ret = "<ul>";

        for(var cfc of cfcs){
            ret += "<li> cfc de "+cfc[0]+" : {";
            for(var n in cfc){
                ret += cfc[n];

                if(n < cfc.length-1){
                    ret += " ; ";
                }
            }
            ret += "}</li>";
        }

        ret += "</ul>";

        document.getElementById(selector).innerHTML = ret;

    }
    </script>
</body>
</html>
